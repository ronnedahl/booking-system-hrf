<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug API - fastai.se</title>
    <style>
        body {
            font-family: monospace;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #1e1e1e;
            color: #d4d4d4;
        }
        h1 { color: #4ec9b0; }
        button {
            background-color: #007acc;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #005a9e; }
        .result {
            background: #252526;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #007acc;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .error { border-left-color: #f14c4c; }
        .success { border-left-color: #89d185; }
    </style>
</head>
<body>
    <h1>üîç API Debug Tool</h1>

    <div>
        <button onclick="testDirect()">Test: /api/login.php (Direct)</button>
        <button onclick="testBackend()">Test: /backend/api/login.php (Direct Backend)</button>
        <button onclick="testCORS()">Test: CORS Headers</button>
    </div>

    <div id="results"></div>

    <script>
        const resultsDiv = document.getElementById('results');

        function addResult(title, content, isError = false) {
            const div = document.createElement('div');
            div.className = 'result ' + (isError ? 'error' : 'success');
            div.innerHTML = `<strong>${title}</strong>\n${content}`;
            resultsDiv.insertBefore(div, resultsDiv.firstChild);
        }

        async function testDirect() {
            try {
                const response = await fetch('/api/login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ code: 'petertestar' })
                });

                const contentType = response.headers.get('content-type');
                const text = await response.text();

                let result = `Status: ${response.status}\n`;
                result += `Content-Type: ${contentType}\n\n`;
                result += `Response Headers:\n`;
                for (let [key, value] of response.headers.entries()) {
                    result += `  ${key}: ${value}\n`;
                }
                result += `\nResponse Body (first 500 chars):\n${text.substring(0, 500)}`;

                addResult('‚úÖ /api/login.php Response', result, !contentType?.includes('json'));

                if (contentType?.includes('json')) {
                    try {
                        const json = JSON.parse(text);
                        addResult('üìÑ Parsed JSON', JSON.stringify(json, null, 2));
                    } catch (e) {
                        addResult('‚ùå JSON Parse Error', e.message, true);
                    }
                }

            } catch (error) {
                addResult('‚ùå Fetch Error (/api/login.php)', error.message, true);
            }
        }

        async function testBackend() {
            try {
                const response = await fetch('/backend/api/login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ code: 'petertestar' })
                });

                const contentType = response.headers.get('content-type');
                const text = await response.text();

                let result = `Status: ${response.status}\n`;
                result += `Content-Type: ${contentType}\n\n`;
                result += `Response Body (first 500 chars):\n${text.substring(0, 500)}`;

                addResult('‚úÖ /backend/api/login.php Response', result, !contentType?.includes('json'));

            } catch (error) {
                addResult('‚ùå Fetch Error (/backend/api/login.php)', error.message, true);
            }
        }

        async function testCORS() {
            try {
                const response = await fetch('/api/login.php', {
                    method: 'OPTIONS'
                });

                let result = `Status: ${response.status}\n\nCORS Headers:\n`;
                const corsHeaders = [
                    'access-control-allow-origin',
                    'access-control-allow-methods',
                    'access-control-allow-headers',
                    'access-control-allow-credentials'
                ];

                for (let header of corsHeaders) {
                    const value = response.headers.get(header);
                    result += `  ${header}: ${value || 'NOT SET'}\n`;
                }

                addResult('‚úÖ CORS Preflight', result);

            } catch (error) {
                addResult('‚ùå CORS Test Error', error.message, true);
            }
        }
    </script>
</body>
</html>
